<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Crash Game Setup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0f0f1a;
            --card: #1a1a2e;
            --border: #2a2a4a;
            --primary: #7c5cff;
            --success: #00d68f;
            --danger: #ff6b6b;
            --text: #ffffff;
            --text-secondary: #9ca3af;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 30px 0;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .step {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .step-number.done {
            background: var(--success);
        }

        .step-title {
            font-size: 16px;
            font-weight: 600;
        }

        .step-content {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .step-content a {
            color: var(--primary);
            text-decoration: none;
        }

        .step-content ol {
            padding-left: 20px;
            margin: 12px 0;
        }

        .step-content li {
            margin-bottom: 8px;
        }

        .input-group {
            margin: 16px 0;
        }

        .input-group label {
            display: block;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 14px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 14px;
            outline: none;
        }

        .input-group input:focus {
            border-color: var(--primary);
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            transition: transform 0.2s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #5c9cff);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #00b37a);
            color: white;
        }

        .result-box {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin-top: 16px;
        }

        .result-box h4 {
            font-size: 14px;
            margin-bottom: 12px;
            color: var(--success);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .result-value {
            font-size: 12px;
            font-family: monospace;
            background: var(--card);
            padding: 6px 10px;
            border-radius: 6px;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .copy-btn {
            padding: 6px 12px;
            background: var(--primary);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            margin-left: 8px;
        }

        .alert {
            padding: 14px;
            border-radius: 10px;
            font-size: 13px;
            margin: 16px 0;
        }

        .alert-info {
            background: rgba(124, 92, 255, 0.15);
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .alert-success {
            background: rgba(0, 214, 143, 0.15);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert-danger {
            background: rgba(255, 107, 107, 0.15);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .code-block {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin: 16px 0;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .hidden {
            display: none !important;
        }

        .config-display {
            background: #1e1e32;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .config-display h3 {
            font-size: 16px;
            margin-bottom: 16px;
            color: var(--success);
        }

        .final-step {
            text-align: center;
            padding: 30px 0;
        }

        .final-step .icon {
            font-size: 60px;
            margin-bottom: 16px;
        }

        .final-step h2 {
            margin-bottom: 10px;
        }

        .final-step p {
            color: var(--text-secondary);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Crash Game Setup</h1>
            <p>Follow these steps to configure your game</p>
        </div>

        <!-- Step 1: JSONBin Account -->
        <div class="step" id="step1">
            <div class="step-header">
                <div class="step-number" id="step1Number">1</div>
                <div class="step-title">Create JSONBin.io Account</div>
            </div>
            <div class="step-content">
                <ol>
                    <li>Go to <a href="https://jsonbin.io" target="_blank">jsonbin.io</a></li>
                    <li>Click "Sign Up" and create a free account</li>
                    <li>Verify your email address</li>
                    <li>Login to your dashboard</li>
                </ol>
                <button class="btn btn-primary" onclick="completeStep1()">
                    I've Created My Account ‚úì
                </button>
            </div>
        </div>

        <!-- Step 2: Get API Key -->
        <div class="step hidden" id="step2">
            <div class="step-header">
                <div class="step-number" id="step2Number">2</div>
                <div class="step-title">Get Your API Key</div>
            </div>
            <div class="step-content">
                <ol>
                    <li>In JSONBin dashboard, click "API Keys" tab</li>
                    <li>Click "Create Access Key"</li>
                    <li>Copy the generated key</li>
                    <li>Paste it below:</li>
                </ol>
                <div class="input-group">
                    <label>Your JSONBin API Key</label>
                    <input type="text" id="apiKeyInput" placeholder="$2a$10$xxxxxxxxxxxxxxxxxxxxxxxxx">
                </div>
                <button class="btn btn-primary" onclick="completeStep2()">
                    Continue ‚Üí
                </button>
            </div>
        </div>

        <!-- Step 3: Create Database -->
        <div class="step hidden" id="step3">
            <div class="step-header">
                <div class="step-number" id="step3Number">3</div>
                <div class="step-title">Create Database</div>
            </div>
            <div class="step-content">
                <p>Click the button below to automatically create your database:</p>
                
                <div class="loading" id="createLoading">
                    <div class="spinner"></div>
                    <p>Creating database...</p>
                </div>
                
                <div id="createButton">
                    <button class="btn btn-success" onclick="createDatabase()">
                        üöÄ Create Database
                    </button>
                </div>
                
                <div class="alert alert-danger hidden" id="createError"></div>
                
                <div class="result-box hidden" id="createResult">
                    <h4>‚úÖ Database Created Successfully!</h4>
                    <div class="result-item">
                        <span class="result-label">Bin ID:</span>
                        <span class="result-value" id="binIdResult">-</span>
                        <button class="copy-btn" onclick="copyBinId()">Copy</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Update Config -->
        <div class="step hidden" id="step4">
            <div class="step-header">
                <div class="step-number" id="step4Number">4</div>
                <div class="step-title">Update Your Code</div>
            </div>
            <div class="step-content">
                <p>Copy the values below and update your <code>api.js</code> file:</p>
                
                <div class="config-display">
                    <h3>üìã Your Configuration</h3>
                    <div class="code-block" id="configCode">
// Update these in api.js:
const CONFIG = {
    JSONBIN_API_KEY: 'YOUR_API_KEY',
    JSONBIN_BIN_ID: 'YOUR_BIN_ID',
    // ... rest of config
};
                    </div>
                    <button class="copy-btn" onclick="copyConfig()" style="width: 100%; padding: 12px; margin-top: 10px;">
                        üìã Copy Configuration
                    </button>
                </div>
                
                <div class="alert alert-info">
                    <strong>Important:</strong> After updating api.js, redeploy your website to Vercel.
                </div>
                
                <button class="btn btn-success" onclick="completeSetup()">
                    I've Updated The Code ‚úì
                </button>
            </div>
        </div>

        <!-- Final Step -->
        <div class="step hidden" id="stepFinal">
            <div class="final-step">
                <div class="icon">üéâ</div>
                <h2>Setup Complete!</h2>
                <p>Your Crash Game is now configured and ready to use.</p>
                
                <button class="btn btn-primary" onclick="goToGame()" style="margin-top: 20px;">
                    üéÆ Open Game
                </button>
                
                <button class="btn btn-success" onclick="goToAdmin()" style="margin-top: 10px; background: linear-gradient(135deg, #ff6b6b, #ee5555);">
                    ‚öôÔ∏è Open Admin Panel
                </button>
            </div>
        </div>
    </div>

    <script>
        let apiKey = '';
        let binId = '';

        function completeStep1() {
            document.getElementById('step1Number').classList.add('done');
            document.getElementById('step1Number').textContent = '‚úì';
            document.getElementById('step2').classList.remove('hidden');
            document.getElementById('step2').scrollIntoView({ behavior: 'smooth' });
        }

        function completeStep2() {
            apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey || !apiKey.startsWith('$2a$10$')) {
                alert('Please enter a valid JSONBin API Key');
                return;
            }
            
            document.getElementById('step2Number').classList.add('done');
            document.getElementById('step2Number').textContent = '‚úì';
            document.getElementById('step3').classList.remove('hidden');
            document.getElementById('step3').scrollIntoView({ behavior: 'smooth' });
        }

        async function createDatabase() {
            document.getElementById('createButton').classList.add('hidden');
            document.getElementById('createLoading').style.display = 'block';
            document.getElementById('createError').classList.add('hidden');

            const initialData = {
                users: {},
                gameState: {
                    id: null,
                    status: 'waiting',
                    bets: [],
                    crashPoint: null,
                    startTime: null,
                    multiplier: 1.00
                },
                gameHistory: [],
                withdrawals: [],
                settings: {
                    minBet: 0.1,
                    maxBet: 100,
                    minWithdraw: 1,
                    houseEdge: 0.03,
                    bettingTime: 10,
                    adminId: '1538232799',
                    tonWallet: 'UQCVA9Y95Rh59Nz_kSjbxCCNogCsL5oog2dhQKrGvoKxHfdn'
                },
                stats: {
                    totalGames: 0,
                    totalBets: 0,
                    totalWagered: 0,
                    totalPayout: 0
                }
            };

            try {
                const response = await fetch('https://api.jsonbin.io/v3/b', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': apiKey,
                        'X-Bin-Name': 'crash-game-db'
                    },
                    body: JSON.stringify(initialData)
                });

                const result = await response.json();

                if (result.metadata?.id) {
                    binId = result.metadata.id;
                    
                    document.getElementById('createLoading').style.display = 'none';
                    document.getElementById('binIdResult').textContent = binId;
                    document.getElementById('createResult').classList.remove('hidden');
                    
                    document.getElementById('step3Number').classList.add('done');
                    document.getElementById('step3Number').textContent = '‚úì';
                    
                    // Update config display
                    updateConfigDisplay();
                    
                    document.getElementById('step4').classList.remove('hidden');
                    document.getElementById('step4').scrollIntoView({ behavior: 'smooth' });
                } else {
                    throw new Error(result.message || 'Failed to create database');
                }
            } catch (error) {
                document.getElementById('createLoading').style.display = 'none';
                document.getElementById('createButton').classList.remove('hidden');
                document.getElementById('createError').textContent = 'Error: ' + error.message;
                document.getElementById('createError').classList.remove('hidden');
            }
        }

        function updateConfigDisplay() {
            const config = `// Update these values in api.js (around line 3-5):

const CONFIG = {
    JSONBIN_API_KEY: '${apiKey}',
    JSONBIN_BIN_ID: '${binId}',
    
    // Your existing config...
    ADMIN_TELEGRAM_ID: '1538232799',
    BOT_USERNAME: 'YourBotUsername',
    TON_WALLET: 'UQCVA9Y95Rh59Nz_kSjbxCCNogCsL5oog2dhQKrGvoKxHfdn',
    // ...
};`;
            
            document.getElementById('configCode').textContent = config;
        }

        function copyBinId() {
            navigator.clipboard.writeText(binId);
            alert('Bin ID copied!');
        }

        function copyConfig() {
            const config = document.getElementById('configCode').textContent;
            navigator.clipboard.writeText(config);
            alert('Configuration copied! Now paste it in your api.js file.');
        }

        function completeSetup() {
            document.getElementById('step4Number').classList.add('done');
            document.getElementById('step4Number').textContent = '‚úì';
            document.getElementById('stepFinal').classList.remove('hidden');
            document.getElementById('stepFinal').scrollIntoView({ behavior: 'smooth' });
            
            // Save to localStorage for reference
            localStorage.setItem('crashGameConfig', JSON.stringify({
                apiKey: apiKey,
                binId: binId,
                setupComplete: true
            }));
        }

        function goToGame() {
            window.location.href = 'index.html';
        }

        function goToAdmin() {
            window.location.href = 'admin.html';
        }

        // Check if already configured
        window.onload = function() {
            const saved = localStorage.getItem('crashGameConfig');
            if (saved) {
                const config = JSON.parse(saved);
                if (config.setupComplete) {
                    if (confirm('Setup was already completed. Go to game?')) {
                        goToGame();
                    }
                }
            }
        };
    </script>
</body>
</html>
